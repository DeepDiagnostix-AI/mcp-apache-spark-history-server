suite: SecretProviderClass
templates:
  - templates/secretproviderclass.yaml

tests:
  - it: renders SecretProviderClass when csisecretstore is enabled
    set:
      auth:
        enabled: true
        csisecretstore:
          enabled: true
          provider: vault
          parameters:
            vaultAddress: http://vault.vault:8200
    asserts:
      - hasDocuments:
          count: 1
      - isKind:
          of: SecretProviderClass
      - equal:
          path: spec.provider
          value: "vault"
      - matchRegex:
          path: metadata.name
          pattern: ".+-spc"

  - it: does not render SecretProviderClass when csisecretstore is disabled
    set:
      auth:
        enabled: true
        csisecretstore:
          enabled: false
    asserts:
      - hasDocuments:
          count: 0
